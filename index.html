---
title: P. Log
---
<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>{{ page.title }}</title>
<style type="text/css">
body {
    background-color: #EEE;
    margin: 0;
}
#gallary {
    width: 1040px;    
}
div.box {
    width: 320px;
    margin: 10px;
    padding: 0;
    display: inline-block;
}
img.photo {
    margin: 0;
    padding: 0;
    width: 320px;
}
.loading-tip {
    position: fixed;
    width: 287px;
    height: 141px;
    background-color: #bbb;
    background: url(plog/img/loading.gif) no-repeat;
    display: none;
}
</style>
<script type="text/javascript" src="{{ baseurl }}/js/lib/jquery-1.9.1.min.js"></script>
<script type="text/javascript">
    var UNIT = 1;
    var pages = 0;
    var timer = -1;
    
    function getData(page, recordsPerPage, callbackName){
        var url = "http://api.flickr.com/services/rest/?"
            + "&method=flickr.people.getPublicPhotos"
            + "&api_key=9c9759651cdfb1accdfca2dfdef0e68a"
            + "&user_id=44093770@N04"
            + "&format=json"
            + "&per_page=" + recordsPerPage
            + "&page=" + page
            + "&jsoncallback=" + callbackName
        $('#js').remove();
         var script = document.createElement('script');
         script.setAttribute("type","text/javascript");
         script.setAttribute("id","js");
         script.src = url;
         document.body.appendChild(script);
     }
     
    // 加载更多图片。
    function loadPhotos() {
        pages ++;
        getData(pages, UNIT, 'appendPhotos');
        popLoadingTips();
    }

    function appendPhotos(data) {
        var gallary = $('#gallary');
        var length = data.photos.photo.length;
        $.each(data.photos.photo, function(i, item){
            var imgurl = "http://farm" + item.farm + ".staticflickr.com/" + item.server 
                + "/" + item.id + "_" + item.secret + ".jpg";
                
            var imglink = "http://www.flickr.com/photos/suyun/" + item.id +"/in/photostream/";
            
            var img = $('<img />').attr('src', imgurl).addClass('photo').attr('title', item.title);
            var a = $('<a />').attr('href', imglink).attr('target', '_blank');
            var div = $('<div />').addClass('box');
            
            img.appendTo(a);
            a.appendTo(div);
            div.appendTo(gallary);
        });
    }
    
    // 滚动到底部
    function scrollToBottom() {
        clearInterval(timer);
        var scrollT = $(window).scrollTop();
        timer = setInterval(function (){
            window.scrollBy(0, 10);
            var curScrollT = $(window).scrollTop();
            if ($(window).scrollTop() == scrollT)clearInterval(timer);
            scrollT = curScrollT;
        }, 10);
    }
    
    // 弹出加载提示
    function popLoadingTips() {
        var tipDiv = $('<div />').addClass('loading-tip').appendTo($('body')).show();
        var left = ($(window).width() - tipDiv.width())/2;
        var top = ($(window).height() - tipDiv.height())/2;
        tipDiv.css({left: left, top: top});
        tipDiv.hide().show(0, function(){
            var _this = $(this);
            setTimeout(function() {
                _this.hide();
            }, 1500);
        });
    }
    
    // 检查垂直滚动条是否已经到底
    function isScrollerBottom() {
        var winH = $(window).height();
        var pageH = $(document.body).height();
        var scrollT = $(window).scrollTop();
        
        if(winH + scrollT == pageH) {
            return true;
        }
        else {
            return false;    
        }
    }
    
    // 检查是否存在垂直滚动条
    function hasVerticalScroller() {
        return (document.documentElement.clientHeight < document.body.offsetHeight);
    }
       
    $(function (){       
        // 有滚动条时，当滚动到底部时，加载图片。
        $(window).scroll(function() { 
            if(isScrollerBottom()) {
                loadPhotos();
            }
        }); 
        
        // 没有滚动条时，只要向下滚动鼠标滚轮，就加载图片。
        $(window).on('mousewheel', function(e){
            var winW = $(window).width();
            var pageW = $(document.body).width();
            
            // 当向下滚动鼠标滚轮时
            if(e.originalEvent.wheelDeltaY < 0) {
                // 当没有出现垂直滚动条(注意要把body的水平margin设为0才有效)时
                if(!hasVerticalScroller()) {
                    loadPhotos();
                }
                // 当有滚动条但滚动条在底部时
                else if(isScrollerBottom()){
                    loadPhotos();
                }
            }
        });        
        
        loadPhotos();
    }); 
</script>
</head>
<body>
    <div id="gallary"></div>
</body>
</html>
